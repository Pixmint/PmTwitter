# PmTwitter

Телеграм-бот, который превращает ссылки на X/Twitter в «карточки» в стиле FxTwitter/FixupX: автор, дата, текст, медиа, цитата, статистика, опросы и опциональный перевод.

Весь интерфейс бота — на русском.

## Возможности
- Поддержка ссылок `x.com`, `twitter.com`, `fxtwitter.com`, `fixupx.com`.
- Ответы в личке и группах; в супергруппах с темами отвечает в том же топике.
- Анти-спам: лимит 1 обработка на пользователя за 5 секунд + лимит на чат.
- Перевод через альтернативный фронтенд (FxTwitter/FixupX), без X API.
- Медиа встраивается как фото/видео, без отправки файлов.
- Опросы (polls) с прогресс-барами.

## Быстрый старт (Docker)
1. Скопируйте `.env.example` в `.env` и заполните `BOT_TOKEN`.
2. Запуск:

```bash
docker compose up -d
```

## Запуск без Docker
```bash
python -m venv .venv
.\.venv\Scripts\activate
pip install -r requirements.txt
set PYTHONPATH=src
python -m bot
```

## Команды
- `/start` — краткое описание
- `/help` — справка
- `/translate <язык|код|off|status|list>` — перевод постов по умолчанию
- `/settings` — показать настройки

Примеры:
- `/translate Русский`
- `/translate en`
- `/translate off`
- `/translate status`
- `/translate list`

## Перевод
- По умолчанию выключен.
- Для перевода используется `FX_BASE_URL` и суффикс `/<lang>`.
- Если перевод получен — выводится оригинал и перевод, а также строка «Переведено с ...».
- Если перевод недоступен — выводится оригинал и пометка.

## ENV-переменные
- `BOT_TOKEN` — токен бота (обязательно)
- `MODE` — режим (`polling` по умолчанию)
- `TELEGRAM_USER_IDS` — белый список через запятую
- `REPLY_IN_GROUPS` — отвечать в группах без упоминания (0/1)
- `COMPRESS_MEDIA` — включить сжатие (0/1)
- `MAX_MEDIA_MB` — лимит размера медиа
- `FX_BASE_URL` — базовый URL фронтенда (например, `https://fxtwitter.com`)
- `FX_BASE_URLS` — список зеркал через запятую (по умолчанию fxtwitter/fixupx/vxtwitter/twitfix)
- `INCLUDE_QUOTED_MEDIA` — включать медиа из цитаты (0/1)
- `DEFAULT_TRANSLATE_LANG` — язык перевода по умолчанию (`off` или `ru`)
- `ALLOW_X_FALLBACK` — разрешить fallback на прямую страницу X при редиректе (0/1)
- `JINA_FALLBACK` — использовать https://r.jina.ai для получения HTML с X (0/1)
- `LOG_LEVEL` — уровень логирования

## Примеры вывода

### Обычный твит
```
Имя Автора (@username) — 20.01.2026, 12:34
Текст твита...
💬 12  🔁 5  ❤️ 100  👁 2000
Оригинал: открыть пост
```

### Цитата и опрос
```
Имя Автора (@username) — 20.01.2026, 12:34
Текст твита...

Цитата Другой Автор (@other) — 20.01.2026, 11:00:
│ Текст цитаты

Ваш выбор?
Да  70%  ██████████████░░░░
Нет  30%  ██████░░░░░░░░░░
123 голосов · завершён

💬 12  🔁 5  ❤️ 100  👁 2000
Оригинал: открыть пост
```

### Перевод
```
Переведено с неизвестного языка
Оригинал...
Перевод...
```

## Тесты
```bash
pytest
```

## Ограничения
- Контент твитов не сохраняется. Хранятся только настройки пользователей.
- Перевод зависит от доступности фронтенда (FxTwitter/FixupX).
